# =========================
# 1) 定義 FastAPI Upstream
# =========================
# 在 Docker Compose 裡，若 fastapi 服務名是 fastapi_app，可直接這樣寫；
# 若您要 --scale fastapi=3，可列多個 server。
upstream fastapi_upstream {
    server fastapi_app:8000;
}

# =========================
# 2) HTTP (80) server block
# =========================
server {
    # 僅開 80，不啟用 443 SSL
    listen 80;
    server_name suzookaizokuhunter; 
    # 如無特定網域，可用 server_name _;

    # =========================
    # Express 代理：/express/ → express_app:3000
    # =========================
    location /express/ {
        # 移除 /express/ 路徑前綴
        rewrite ^/express/(.*) /$1 break;
        proxy_pass http://express_app:3000;

        # (可加額外 proxy_* 設定, 例如超時)
        # proxy_read_timeout 300;
        # proxy_send_timeout 300;
    }

    # =========================
    # FastAPI 代理：/fastapi/ → fastapi_upstream
    # =========================
    location /fastapi/ {
        rewrite ^/fastapi/(.*) /$1 break;
        proxy_pass http://fastapi_upstream;

        # 同理可加超時: 
        # proxy_read_timeout 300;
        # proxy_send_timeout 300;
    }

    # =========================
    # 可加其他靜態檔設定
    # =========================
    # location / {
    #     root /usr/share/nginx/html;
    #     index index.html index.htm;
    # }
}
